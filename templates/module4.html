<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Module 4 ‚Äì Panorama & SIFT</title>

  <style>
    body {
      font-family: "Inter", Arial, sans-serif;
      background: linear-gradient(180deg, #f8fafc, #eef2ff);
      padding: 40px;
      text-align: center;
      color: #1e293b;
    }

    h1 {
      font-size: 34px;
      margin-bottom: 10px;
      font-weight: 800;
      color: #1e40af;
    }

    h2 {
      margin-top: 10px;
      font-size: 24px;
      font-weight: 700;
      color: #334155;
    }

    h3 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #334155;
    }

    .section-box {
      background: white;
      margin: 40px auto;
      padding: 35px;
      border-radius: 18px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.12);
      max-width: 1000px;
    }

    .upload-box {
      background: #f8fafc;
      border: 2px dashed #c7d2fe;
      border-radius: 14px;
      padding: 22px;
      margin-top: 15px;
    }

    .action-btn {
      padding: 14px 28px;
      margin-top: 20px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      cursor: pointer;
      font-weight: 700;
      transition: 0.2s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .action-btn:hover {
      transform: scale(1.03);
    }

    .action-btn:disabled {
      background: #94a3b8;
      cursor: wait;
      transform: none;
    }

    .thumb {
      height: 85px;
      margin: 6px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      background: white;
    }

    img.output {
      max-width: 100%;
      border-radius: 14px;
      margin-top: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    }

    input[type="file"] {
      margin-top: 12px;
      font-size: 14px;
    }

    .comparison-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 30px;
      margin-top: 25px;
    }

    .comparison-col {
      background: #f8fafc;
      padding: 18px;
      border-radius: 14px;
      box-shadow: inset 0 0 0 2px #e5e7eb;
    }

    .subtitle {
      font-size: 15px;
      color: #475569;
      margin-bottom: 10px;
    }
    .demo-wrap {
    width: 100%;
    max-width: 1000px;
    margin: 25px auto 0;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 6px 22px rgba(0,0,0,0.25);
    background: black;
  }

  .demo-wrap iframe {
    width: 100%;
    height: 520px;
    border: none;
  }

  </style>
</head>

<body>

  <h1>Module 4 ‚Äî Panorama Stitching & SIFT</h1>
  <div class="subtitle">Visual Comparison of Image Stitching & Feature Matching</div>

  <!-- ================= PANORAMA ================= -->
  <div class="section-box">
    <h2>üñºÔ∏è Panorama Stitching</h2>
    <p class="subtitle">Compare algorithmic stitching vs mobile panorama</p>

    <div class="upload-box">
        <label><strong>1. Upload Individual Images (Required)</strong></label><br>
        <input type="file" id="panoInput" multiple accept="image/*">

        <br><br>

        <label><strong>2. Upload Phone Panorama (Optional)</strong></label><br>
        <input type="file" id="phonePanoInput" accept="image/*">
    </div>

    <button id="btnStitch" class="action-btn">Stitch & Compare</button>

    <div id="panoResults"></div>
  </div>

  <!-- ================= SIFT ================= -->
  <div class="section-box">
    <h2>üß© SIFT Feature Matching</h2>
    <p class="subtitle">Keypoint detection + RANSAC homography</p>

    <div class="comparison-row">
      <div class="comparison-col">
        <strong>Image A</strong><br>
        <input type="file" id="siftInput1" accept="image/*">
      </div>

      <div class="comparison-col">
        <strong>Image B</strong><br>
        <input type="file" id="siftInput2" accept="image/*">
      </div>
    </div>

    <button id="btnSift" class="action-btn">Run Feature Matching</button>

    <div id="siftResults" style="margin-top:25px;"></div>
  </div>
  <div class="section-box">
    <h2>üìΩÔ∏è Module 4 ‚Äì Demo</h2>

    <div class="demo-wrap">
      <iframe 
        src="https://drive.google.com/file/d/1Ay6DIaBuar7A6S7IA_glcLyT4g40CdLn/preview"
        allow="autoplay; fullscreen"
        allowfullscreen>
      </iframe>
    </div>
  </div>
  <!-- ================= JS (UNCHANGED) ================= -->
  <script>
    // --- PANORAMA LOGIC ---
    const btnStitch = document.getElementById("btnStitch");
    const panoInput = document.getElementById("panoInput");
    const phonePanoInput = document.getElementById("phonePanoInput");
    const panoResults = document.getElementById("panoResults");

    btnStitch.addEventListener("click", async () => {
        if (panoInput.files.length < 2) {
            alert("Please select at least 2 individual images to stitch!");
            return;
        }
        btnStitch.disabled = true;
        btnStitch.innerText = "Stitching...";
        panoResults.innerHTML = "<p>Processing... (This may take a few seconds)</p>";

        const fd = new FormData();
        for (const file of panoInput.files) fd.append("images", file);
        if (phonePanoInput.files.length > 0) fd.append("phone_pano", phonePanoInput.files[0]);

        const res = await fetch("/process_stitch", { method: "POST", body: fd });
        const data = await res.json();

        if (data.error) {
            panoResults.innerHTML = `<p style="color:red;">${data.error}</p>`;
        } else {
            let html = "<h3>Input Images</h3>";
            data.thumbnails.forEach(t => html += `<img class="thumb" src="data:image/jpeg;base64,${t}">`);

            html += `<div class="comparison-row">
                      <div class="comparison-col">
                        <h3>‚úÖ Generated Panorama</h3>
                        <img class="output" src="data:image/jpeg;base64,${data.stitched}">
                      </div>`;

            if (data.phone_pano) {
                html += `<div class="comparison-col">
                          <h3>üì± Phone Panorama</h3>
                          <img class="output" src="data:image/jpeg;base64,${data.phone_pano}">
                        </div>`;
            }

            html += `</div>`;
            panoResults.innerHTML = html;
        }

        btnStitch.disabled = false;
        btnStitch.innerText = "Stitch & Compare";
    });

    // --- SIFT LOGIC ---
    const btnSift = document.getElementById("btnSift");
    const sift1 = document.getElementById("siftInput1");
    const sift2 = document.getElementById("siftInput2");
    const siftResults = document.getElementById("siftResults");

    btnSift.addEventListener("click", async () => {
        if (!sift1.files[0] || !sift2.files[0]) {
            alert("Please select both images!");
            return;
        }

        btnSift.disabled = true;
        btnSift.innerText = "Processing...";
        siftResults.innerHTML = "";

        const fd = new FormData();
        fd.append("img1", sift1.files[0]);
        fd.append("img2", sift2.files[0]);

        const res = await fetch("/process_sift", { method: "POST", body: fd });
        const data = await res.json();

        if (data.error) {
            siftResults.innerHTML = `<p style="color:red;">${data.error}</p>`;
        } else {
            siftResults.innerHTML = `
                <h3>Custom SIFT + RANSAC</h3>
                <img class="output" src="data:image/jpeg;base64,${data.custom}">
                <h3>OpenCV SIFT Matches</h3>
                <img class="output" src="data:image/jpeg;base64,${data.opencv}">
            `;
        }

        btnSift.disabled = false;
        btnSift.innerText = "Run Feature Matching";
    });
  </script>

</body>
</html>
